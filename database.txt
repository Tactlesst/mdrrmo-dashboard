CREATE TABLE pcr_forms (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  patient_name TEXT NOT NULL,
  date DATE NOT NULL,
  location TEXT,
  recorder TEXT,
  full_form JSONB,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  created_by_type TEXT NOT NULL CHECK (created_by_type IN ('admin', 'responder')),
  created_by_id UUID NOT NULL
);

  '{
    "case_number": "PCR-20250801-001",
    "age": 32,
    "sex": "Male",
    "contact_number": "09171234567",
    "address": "Zone 3, Barangay 5",
    "poi_type": "Vehicular Accident",
    "poi_details": "Collision with tricycle",
    "vitals": {
      "blood_pressure": "120/80",
      "pulse_rate": 78,
      "respiratory_rate": 18,
      "temperature": "36.7",
      "oxygen_saturation": "98%",
      "gcs_eye": 4,
      "gcs_verbal": 5,
      "gcs_motor": 6
    },
    "history_present_illness": "Patient was riding motorcycle, hit from the side by tricycle.",
    "past_medical_history": "None",
    "medications": "None",
    "allergies": "Penicillin",
    "body_diagram": ["right-leg", "left-arm"],
    "waiver_signed": true
  }'::jsonb,
  'responder',
  2}

CREATE TABLE provinces (
  id SERIAL PRIMARY KEY,
  name TEXT UNIQUE NOT NULL
);
CREATE TABLE municipalities (
  id SERIAL PRIMARY KEY,
  name TEXT NOT NULL,
  province_id INTEGER REFERENCES provinces(id)
);
CREATE TABLE barangays (
  id SERIAL PRIMARY KEY,
  name TEXT NOT NULL,
  municipality_id INTEGER REFERENCES municipalities(id)
);
CREATE TABLE streets (
  id SERIAL PRIMARY KEY,
  name TEXT NOT NULL,
  barangay_id INTEGER REFERENCES barangays(id)
);


CREATE TABLE users (
  id SERIAL PRIMARY KEY,
  name VARCHAR(100) NOT NULL,
  email VARCHAR(100) UNIQUE NOT NULL,
  password TEXT,
  dob DATE,
  contact VARCHAR(20),
  address TEXT,
  image_url TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS alerts (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  address TEXT,
  type TEXT,                        
  status TEXT DEFAULT 'Not Responded',
  occurred_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  lat DOUBLE PRECISION NOT NULL,
  lng DOUBLE PRECISION NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  
  responder_id INTEGER REFERENCES responders(id) ON DELETE SET NULL,
  responded_at TIMESTAMP
);

CREATE TABLE IF NOT EXISTS responders (
  id INTEGER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
  email TEXT UNIQUE NOT NULL,
  password TEXT NOT NULL,
  name TEXT NOT NULL,
  image_url TEXT DEFAULT NULL,
  is_active BOOLEAN DEFAULT FALSE,
  dob DATE DEFAULT NULL,          -- Date of Birth
  contact TEXT DEFAULT NULL,      -- Contact number
  address TEXT DEFAULT NULL       -- Address
);

CREATE TABLE admin_sessions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  admin_email TEXT REFERENCES admins(email) ON DELETE CASCADE,
  is_active BOOLEAN DEFAULT TRUE,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  last_active_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  ip_address TEXT,
  user_agent TEXT
);

CREATE TABLE login_logs (
  id SERIAL PRIMARY KEY,
    admin_id INTEGER REFERENCES admins(id),
      email TEXT,
        ip_address TEXT,
          user_agent TEXT,
            login_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP
            );

CREATE TABLE IF NOT EXISTS admins (
  id SERIAL PRIMARY KEY,
  email TEXT UNIQUE NOT NULL,
  password TEXT NOT NULL,
  name TEXT DEFAULT 'Administrator',
  image_url TEXT DEFAULT NULL,
  dob DATE DEFAULT NULL,          -- Date of Birth
  contact TEXT DEFAULT NULL,      -- Contact number
  address TEXT DEFAULT NULL       -- Address
);
